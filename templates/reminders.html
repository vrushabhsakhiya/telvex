{% extends 'base.html' %}

{% block content %}
<div class="page-header" style="margin-bottom: 2rem;">
    <h2 style="font-size: 1.5rem; font-weight: 600;">{{ t('reminders_activity') }}</h2>
</div>

<div class="grid-layout"
    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">

    <!-- Card 1: Urgent (Today & Overdue) -->
    <div class="card" style="border-top: 4px solid var(--danger-color);">
        <div class="card-header">
            <div class="card-title">
                <i class="fa-solid fa-triangle-exclamation"
                    style="color: var(--danger-color); margin-right: 0.5rem;"></i>
                {{ t('urgent_today') }}
            </div>
            <span
                style="background: #FEE2E2; color: var(--danger-color); padding: 0.25rem 0.5rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 600;">
                {{ urgent_orders|length }}
            </span>
        </div>

        <div class="reminder-list">
            {% for order in urgent_orders %}
            <div class="reminder-item" style="border-left: 3px solid var(--danger-color);">
                <div class="reminder-content">
                    <div class="reminder-title">{{ order.customer.name }}</div>
                    <div class="reminder-meta">
                        Order {{ order.id }} - {{ order.items[0].name if order.items else 'Items' }}
                        <br>
                        <strong style="color: var(--danger-color);">
                            {% if order.delivery_date %}
                            Due: {{ order.delivery_date.strftime('%d-%b') }}
                            {% else %}
                            Urgent
                            {% endif %}
                        </strong>
                    </div>
                </div>
                <div class="reminder-actions">
                    <a href="tel:{{ order.customer.mobile }}" class="btn-icon btn-call" title="Call"><i
                            class="fa-solid fa-phone"></i></a>
                    <a href="{{ url_for('orders') }}" class="btn-icon btn-check" title="Manage Order"><i
                            class="fa-solid fa-arrow-right"></i></a>
                </div>
            </div>
            {% else %}
            <p style="text-align: center; color: var(--text-secondary); padding: 1rem;">{{ t('no_urgent_deliveries') }}
            </p>
            {% endfor %}
        </div>
    </div>

    <!-- Card 2: Upcoming (Tomorrow) -->
    <div class="card" style="border-top: 4px solid var(--warning-color);">
        <div class="card-header">
            <div class="card-title">
                <i class="fa-solid fa-calendar-day" style="color: var(--warning-color); margin-right: 0.5rem;"></i>
                {{ t('tomorrow') }}
            </div>
            <span
                style="background: #FFF7ED; color: var(--warning-color); padding: 0.25rem 0.5rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 600;">
                {{ upcoming_orders|length }}
            </span>
        </div>

        <div class="reminder-list">
            {% for order in upcoming_orders %}
            <div class="reminder-item">
                <div class="reminder-content">
                    <div class="reminder-title">{{ order.customer.name }}</div>
                    <div class="reminder-meta">
                        Order {{ order.id }} - {{ order.items[0].name if order.items else 'Items' }}
                        <br>
                        <span style="color: var(--warning-color);">{{ t('due_tomorrow') }}</span>
                    </div>
                </div>
                <div class="reminder-actions">
                    <a href="{{ url_for('orders') }}" class="btn-icon btn-check" title="View"><i
                            class="fa-solid fa-arrow-right"></i></a>
                </div>
            </div>
            {% else %}
            <p style="text-align: center; color: var(--text-secondary); padding: 1rem;">{{ t('no_deliveries_tomorrow')
                }}</p>
            {% endfor %}
        </div>
    </div>

    <!-- Card 3: Pending Payments -->
    <div class="card" style="border-top: 4px solid var(--primary-color);">
        <div class="card-header">
            <div class="card-title">
                <i class="fa-solid fa-circle-dollar-to-slot"
                    style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                {{ t('pending_payments') }}
            </div>
            <span
                style="background: #DBEAFE; color: var(--primary-color); padding: 0.25rem 0.5rem; border-radius: 1rem; font-size: 0.75rem; font-weight: 600;">
                {{ pending_payments|length }}
            </span>
        </div>

        <div class="reminder-list">
            {% for order in pending_payments %}
            <div class="reminder-item">
                <div class="reminder-content">
                    <div class="reminder-title">{{ order.customer.name }}</div>
                    <div class="reminder-meta">
                        Order {{ order.id }} ({{ order.created_at.strftime('%d-%b') }})
                        <br>
                        <strong style="color: var(--danger-color);">{{ t('due') }}: â‚¹{{ order.balance }}</strong>
                    </div>
                </div>
                <div class="reminder-actions">
                    <a href="{{ url_for('bills') }}" class="btn-icon btn-check" title="Go to Bills"><i
                            class="fa-solid fa-file-invoice-dollar"></i></a>
                </div>
            </div>
            {% else %}
            <p style="text-align: center; color: var(--text-secondary); padding: 1rem;">{{ t('no_pending_payments') }}
            </p>
            {% endfor %}
        </div>
    </div>

</div>

<style>
    .reminder-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        max-height: 400px;
        overflow-y: auto;
        padding-right: 5px;
    }

    .reminder-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        background: var(--bg-color);
        transition: transform 0.1s;
    }

    .reminder-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .reminder-title {
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 2px;
    }

    .reminder-meta {
        font-size: 0.8rem;
        color: var(--text-secondary);
        line-height: 1.3;
    }

    .reminder-actions {
        display: flex;
        gap: 0.5rem;
    }

    .btn-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: 0.2s;
        text-decoration: none;
    }

    .btn-call {
        background: #E0F2FE;
        color: var(--secondary-color);
    }

    .btn-call:hover {
        background: var(--secondary-color);
        color: white;
    }

    .btn-msg {
        background: #DCFCE7;
        color: var(--accent-color);
    }

    .btn-check {
        background: #F3F4F6;
        color: var(--text-secondary);
    }

    .btn-check:hover {
        background: var(--primary-color);
        color: white;
    }
</style>
{% endblock %}